# LOGOS LRB — КАНОН РАБОТЫ (ОБЯЗАТЕЛЬНО К ВЫПОЛНЕНИЮ)

## 0) Цель
Конечная цель — **полностью рабочий резонансный блокчейн LOGOS LRB**, интегрированный с нашим приложением: узел принимает и финализирует транзакции, поддерживает резонансные модули, API совместимо с мобильным клиентом. **Никаких заглушек и TODO** — только боевой, собранный и проверенный код.

---

## 1) Канон внесения изменений (обязательный порядок)
Каждое изменение оформляется ТОЛЬКО так:

1. **Создание директорий (если нужно):**
   - `mkdir -p <путь/к/директории>`

2. **Вход в целевую директорию:**
   - `cd <путь/к/директории>`

3. **Удаление старого файла (если он есть):**
   - `rm -f <имя_файла>`

4. **Открытие nano для нового файла:**
   - `nano <имя_файла>`

5. **Вставка ПОЛНОГО, боевого кода** (всё содержимое файла целиком).
   - Без «патчей» и диффов — ВСЕГДА полный файл.
   - Без заглушек, TODO, псевдокода.

6. **Сохранение → выход → сборка/проверка.**

Этот канон применяется к любым файлам (Rust, Python, YAML, systemd, shell-скрипты и т.д.).

---

## 2) Требования к коду
- **Ни одного `unsafe`/`unwrap`/`expect`/`panic!`** в путях выполнения продакшена.
- Чёткие `Result`/ошибки, логирование, предсказуемое поведение при сбоях.
- Rust: `cargo build --release -p logos_node` **должен проходить без ошибок**.
- Python: синтаксис чистый, без `eval/exec`; утилиты не мешают прод-пути.
- Конфиги валидируются парсером/схемой, лежат в `configs/`.
- systemd-юниты запускаются и переживают рестарты; порт слушается постоянно.

---

## 3) Проверки после каждого изменения
1. **Сборка узла:**  
   `cd /root/logos_lrb && cargo build --release -p logos_node`

2. **Запуск узла (локально):**  
   `./target/release/logos_node`  
   Проверка:  
   - `curl -s http://127.0.0.1:8080/healthz` → `{"ok":true}`  
   - `curl -s http://127.0.0.1:8080/head`

3. **Автозапуск (systemd):**  
   - Юнит: `/etc/systemd/system/logos-node.service`  
   - `systemctl enable --now logos-node.service`  
   - `systemctl status logos-node.service`  
   - `journalctl -u logos-node.service -f`

4. **Генерация дерева проекта:**  
   - `/root/logos_lrb/tools/gen_full_tree.sh`  
   - Коммит `FULL_TREE.md`.

---

## 4) Правила коммитов/репозитория
- Любое изменение кода/конфигов сопровождается **коммитом** в `main`.
- Сообщение коммита короткое и предметное: что изменено и зачем.
- Не коммитить артефакты сборки (`target/`, `node_modules/`, и т.п.).
- Поддерживать `FULL_TREE.md` и `AUDIT_REPORT.md` в актуальном состоянии.

---

## 5) Стандарты API и интеграции
- Узел (`logos_node`) обязан держать REST:
  - `GET /healthz` — жив ли.
  - `GET /head` — {height, hash}.
  - `GET /balance/:rid` — баланс.
  - `POST /submit_tx` — приём tx (Ed25519, base58 RID).
- Мобильный клиент должен уметь:
  - генерировать ключи / RID (Ed25519 → base58),
  - формировать каноничное сообщение, подписывать, отправлять в `/submit_tx`,
  - опрашивать `head` и `balance`.

---

## 6) Безопасность и эксплуатация
- Лимиты и квоты — на входе (spam-guard) и в mempool.
- LGN_cost — адаптивный (dynamic_balance).
- **Никаких секретов в репозитории** (ключи/пароли).
- Логи — в journal/systemd, при необходимости `RUST_LOG=info`.

---

## 7) Оркестрация «одним дыханием»
- Все шаги (создание директорий → nano → полный код → сборка → проверки) делаются **в одном заходе** согласно канону из раздела 1.
- Любые новые службы/скрипты оформлять аналогично (полный код, без TODO).

---

## 8) Мини-чеклист перед «готово»
- `cargo build --release -p logos_node` — ОК
- `/healthz`, `/head`, `/balance/:rid`, `/submit_tx` — ОК
- `logos-node.service` — Active (running)
- `FULL_TREE.md` — обновлён
- Нет `unsafe`/`unwrap`/`expect`/`panic!` в прод-пути
